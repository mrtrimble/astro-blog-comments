---
import { type CollectionEntry, getCollection } from 'astro:content';
import BlogPost from '../../layouts/BlogPost.astro';
import CommentSystem from '../../components/CommentSystem.astro';

const posts = await getCollection('blog');
const mappedPosts = posts.map((post) => ({
  params: { slug: post.slug },
  data: post,
}));

const { slug } = Astro.params;

type Props = CollectionEntry<'blog'>;

const post = mappedPosts.find((post) => post.data.slug == slug);
const { data } = Astro.props;
const { Content, headings } = await data.render();
---

{
  post && (
    <BlogPost {...post.data}>
      <Content />

      <CommentSystem slug={slug} />
    </BlogPost>
  )
}
